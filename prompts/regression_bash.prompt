% You are an expert test engineer. Your goal is to write a Bash script, "regression.sh" that will create a comprehensive regression test for the pdd cli.

% Here is the pdd README.md file: <pdd_readme><include>./README.md</include></pdd_readme>

% Here is an example of a regression script that tests the 'cli' function: <regression_example><include>context/regression_example.sh</include></regression_example>

% However, unlike in the above regression example, the pdd cli has to run in the current directory instead of cd "$STAGING_PATH/regression". All the output files should still be in the "$STAGING_PATH/regression" directory.

% Make sure all the functionality of pdd is exercised in the regression script.

% Additional requirements:
    1. Use consistent variables across different commands. For example, use EXTENSION_SCRIPT and EXTENSION_VERIFICATION_PROGRAM in multiple commands where applicable.
    2. Remove any unused variables to keep the script clean and efficient.
    3. For the 'trace' command, use line number 31 as an example.
    4. In the 'crash' command, use EXTENSION_VERIFICATION_PROGRAM instead of TRACE_PROGRAM.
    5. For the 'bug' command:
        - Use EXTENSION_SCRIPT and EXTENSION_VERIFICATION_PROGRAM
        - Use specific Python extension examples:
            - Current output: "The file extension for 'Python' is: '.py'"
            - Desired output: "The file extension for 'Python' is: 'py'"
        - Include "bug_" in the output filename
    6. Ensure all commands use appropriate and consistent file paths and variables.
    7. Use a strength of 0.85 and a temperature of 1.0 for all commands.
    8. For the update command:
        - Create a backup of the original extension script
        - Modify the extension script by adding a print statement
        - Use both modified and original versions in the update command
    9. Add comprehensive logging functionality:
        - Include a timestamped log file (regression.log)
        - Track the success or failure of each command
        - Add a verbose output option (enabled by default)
    10. Implement the 'fix --loop' command:
        - Include parameters like --max-attempts and --budget
        - Specify output file locations for test, code, and results
        - Use the verification program in the command
    11. Add OS-specific code for the sed command to handle differences between macOS (BSD sed) and Linux (GNU sed)
    12. Include error handling that checks command success and exits if a command fails
    13. Add a summary at the end that calculates the total cost from all operations
    14. After the 'crash' command, check if output files exist before copying them to be used in subsequent commands

% Set PDD_AUTO_UPDATE to false for the regression script so pdd doesn't ask to update itself.

% Remove the current regression.log file if it exists when starting.

% Include a cost output file (regression_cost.csv) to track the cost of each command and calculate the total at the end.