% You are an expert software engineer using Prompt-Driven Development (PDD). Your task is to identify any architectural or implementation decisions that need user input before proceeding.

% Context

You are working on step 7 of 12 in an agentic change workflow. Previous steps identified the dev units involved. Now you must determine if there are architectural questions that require user input before designing prompt changes.

**This step may STOP the workflow** if architectural decisions are needed. When the user answers and runs `pdd change` again, this step will re-evaluate.

% PDD Background

<pdd_prompting_guide>
<include>docs/prompting_guide.md</include>
</pdd_prompting_guide>

% Inputs

- GitHub Issue URL: {issue_url}
- Repository: {repo_owner}/{repo_name}
- Issue Number: {issue_number}
- Issue Author: {issue_author}

% Issue Content
<issue_content>
{issue_content}
</issue_content>

% Previous Step Outputs
<step1_output>
{step1_output}
</step1_output>

<step2_output>
{step2_output}
</step2_output>

<step3_output>
{step3_output}
</step3_output>

<step4_output>
{step4_output}
</step4_output>

<step5_output>
{step5_output}
</step5_output>

<step6_output>
{step6_output}
</step6_output>

% Your Task

1. **Review the dev units and changes identified**
   - Understand which modules/prompts will be affected
   - Consider the scope and complexity of changes

2. **Identify architectural questions**
   Look for decisions that could significantly impact implementation:
   - **Design patterns**: Which pattern is most appropriate? (e.g., strategy vs factory)
   - **Trade-offs**: Performance vs simplicity? Flexibility vs complexity?
   - **Integration approach**: How should new code integrate with existing modules?
   - **Dependency direction**: Which module should depend on which?
   - **API design**: What should the interface look like?
   - **Error handling strategy**: Fail fast vs graceful degradation?
   - **Configuration**: Hardcoded vs configurable? Environment variables vs config file?

3. **Decide: Proceed or Ask Questions**

   **PROCEED** if:
   - Implementation approach is straightforward
   - Standard patterns apply without ambiguity
   - No significant trade-offs to consider
   - Any decisions can be reasonably made by the developer

   **ASK QUESTIONS** if:
   - Multiple valid architectural approaches exist
   - Trade-offs need user input (they know their priorities)
   - Changes could affect system behavior significantly
   - User preferences would change the implementation approach

4. **If questions needed, formulate them**
   - Ask specific, technical questions
   - Provide 2-3 concrete options for each question
   - Explain trade-offs for each option
   - Limit to 2-4 most critical questions

% Output

After completing your analysis, use `gh issue comment` to post your findings to issue #{issue_number}:

```
gh issue comment {issue_number} --repo {repo_owner}/{repo_name} --body "..."
```

**If NO architectural questions (proceed):**
```markdown
## Step 7: Architecture Review

**Status:** Architecture Clear

### Analysis
The implementation approach is straightforward based on the dev units identified in Step 6.

### Implementation Approach
- [Brief description of how changes will be structured]
- [Key patterns or approaches that will be used]

### Assumptions
- [Any architectural assumptions being made]

---
*Proceeding to Step 8: Analyze Prompt Changes*
```

**If ARCHITECTURAL QUESTIONS needed (STOP workflow):**
```markdown
## Step 7: Architecture Review

**Status:** Architectural Decision Needed

### Context
Based on the dev units identified in Step 6, the following architectural decisions need your input before proceeding.

### Questions for @{issue_author}

1. **[Topic - e.g., "Data Storage Approach"]**

   [Brief context explaining why this matters]

   **Options:**
   - **A) [Option name]**: [Description]
     - Pros: [benefits]
     - Cons: [drawbacks]
   - **B) [Option name]**: [Description]
     - Pros: [benefits]
     - Cons: [drawbacks]
   - **C) [Option name]**: [Description]
     - Pros: [benefits]
     - Cons: [drawbacks]

   **Recommendation:** [Your suggestion if you have one, and why]

2. **[Topic]**

   [Context]

   **Options:**
   - **A)** [Option and trade-offs]
   - **B)** [Option and trade-offs]

### Next Steps
Please reply with your preferred options (e.g., "1A, 2B"). Then run `pdd change {issue_url}` again to continue.

---
*Workflow paused - awaiting architectural decisions from @{issue_author}*
```

% Important

- Focus on decisions that significantly impact the implementation
- Don't ask about minor implementation details - use good judgment
- Provide clear options with trade-offs explained
- Make recommendations where you have a strong opinion
- Always tag the issue author (@{issue_author}) when asking questions
- This is a HARD STOP - if questions are needed, the workflow terminates here
- When `pdd change` is run again, this step will re-evaluate based on new comments

% CRITICAL: Output Format for Stop Condition

If architectural decisions are needed, your final response MUST include this exact line:

STOP_CONDITION: Architectural decision needed

This line MUST:
- Appear in your final output (not just in the GitHub comment)
- Use exact casing shown above (lowercase "decision needed")
- Be on its own line for reliable parsing

If NO architectural decisions are needed (proceeding to Step 8), do NOT include this line.
