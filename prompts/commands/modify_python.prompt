<include>context/python_preamble.prompt</include>

% Goal
Write `pdd/commands/modify.py`.

% Role & Scope
This module contains Click commands that modify prompts: `split`, `change`, and `update`.

% Requirements
1. **split**: Call `split_main` with arguments: input_prompt, input_code, example_code, output_sub, output_modified

2. **change**: Two modes determined by `--manual` flag:
   - **Agentic mode (default)**: Takes single GitHub issue URL argument, calls `run_agentic_change(issue_url, verbose, quiet, timeout_adder, use_github_state)`. Returns 5-tuple: (success, message, cost, model, changed_files). Display success status, cost, model used, and list of changed files using click.echo.
   - **Manual mode (`--manual` flag)**: Legacy behavior. Validate csv-vs-file mode, call `change_main`. Options: `--budget` (float, default 5.0), `--output`, `--csv` flag, `--timeout-adder` (float, default 0.0, agentic mode only), `--no-github-state` (flag, disables GitHub state persistence, agentic mode only)
   - Agentic mode: exactly 1 arg (issue URL)
   - Manual mode without --csv: 3 args required (change_prompt_file, input_code, input_prompt_file)
   - Manual mode with --csv: 2 args (csv_file, code_directory) - input_prompt_file not used

3. **update**: Four modes determined by argument count (per README documentation):
   - **Repo-wide mode (0 args)**: Scan entire repo. Options: `--extensions` (comma-separated), `--directory`
   - **Regeneration mode (1 arg)**: `<code_file>`. Derive prompt path via conventions. Options: `--git`, `--output`
   - **Git-based update (2 args)**: `<prompt> <modified_code>`. Requires `--git` flag; raise UsageError if missing
   - **Manual update (3 args)**: `<prompt> <modified_code> <original_code>`. Raise UsageError if `--git` also set (mutually exclusive per update_main spec)
   - Pass to `update_main`: `repo=is_repo_mode`, `input_prompt_file=files[0]` (for 2-3 args), `modified_code_file=files[1]` (for 2-3 args) or `files[0]` (for 1 arg), `input_code_file=files[2]` (for 3 args only), `use_git`, `output`, `simple`
   - Log operation using `@log_operation(operation="update", clears_run_report=True)`.

4. **update --simple flag**: Boolean flag (default False) to use legacy 2-stage LLM update instead of agentic mode

% Error Handling
- Apply `@track_cost` decorator to each command function
- Re-raise `click.Abort` exceptions (user cancellation) without calling `handle_error`
- For all other exceptions (including `click.UsageError`), call `handle_error(e, command_name, quiet)` and return None

% Instructions
- For `change` command: validate argument count based on mode before calling the appropriate function
- For `update` command: validate argument count and flag combinations (2 args requires --git, 3 args forbids --git)
- Raise `click.UsageError` for validation failures
- In manual mode, validate that file arguments exist before calling change_main

% Dependencies
<include>context/command_logging.prompt</include>
<module_dependencies>
  <pdd.split_main><include>context/split_main_example.py</include></pdd.split_main>
  <pdd.change_main><include>context/change_main_example.py</include></pdd.change_main>
  <pdd.agentic_change><include>context/agentic_change_example.py</include></pdd.agentic_change>
  <pdd.update_main><include>context/update_main_example.py</include></pdd.update_main>
  <pdd.track_cost><include>context/track_cost_example.py</include></pdd.track_cost>
  <pdd.core.errors><include>context/core/errors_example.py</include></pdd.core.errors>
</module_dependencies>

% Deliverables
- Code: `pdd/commands/modify.py`