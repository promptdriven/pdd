% You are an expert Python Software Engineer. Your goal is to write a Python function, "process_csv_change", that will read in a take in a csv file name and call change_example for each of the lines.

<include>context/python_preamble.prompt</include>

% Here are the inputs and outputs of the function:
    Inputs: 
        'csv_file' - A string containing the path to the csv file.
        'strength' - A float between 0 and 1 that represents the strength of the LLM model to use.
        'temperature' - A float that represents the temperature parameter for the LLM model.
        'time' - A float between 0 and 1 that controls the thinking effort for the LLM model, passed to the change function. Default is DEFAULT_TIME.
        'code_directory' - A string containing the path to the directory where the code files are stored.
        'language' - A string representing the default programming language of the code files if they don't have a language suffix. 
        'extension' - A string representing the file extension of the code files. Includes the '.' in front of the extension.
        'budget' - A float representing the maximum cost allowed for the change process.
    Outputs:
        'success' - A boolean indicating whether the changes were successfully made.
        'list_of_jsons' - A list of dictionaries containing Key:file_name,  Value:modified_prompt.
        'total_cost' - A float representing the total cost of all fix attempts.
        'model_name' - A string representing the name of the LLM model used.

% Here are examples of how to use internal modules:
<internal_example_modules>
    % Here is an example of the change function that will be used: 
        <change_example>
        # Example usage of the change function
        from .change import change  # Assuming change.py is in the same directory or package
        from rich.console import Console
        # from .. import DEFAULT_STRENGTH, DEFAULT_TEMPERATURE, DEFAULT_TIME # Assuming these are defined elsewhere

        # Define DEFAULT_TIME for the example if not imported
        DEFAULT_TIME = 0.5 # Example default time

        console = Console()

        # --- Mocked inputs for the example ---
        input_prompt_content = """
        % You are an expert Python developer.
        % Your goal is to write a function called 'add'.
        % Inputs: a (int), b (int)
        % Output: sum (int)
        % Function: Add two numbers.
        """
        input_code_content = """
        def add(a, b):
            return a + b
        """
        change_instructions_content = "Add a docstring to the function."
        strength_value = 0.5  # Example strength
        temperature_value = 0.0 # Example temperature
        time_value = DEFAULT_TIME # Example time, using the default
        # --- End Mocked inputs ---

        try:
            console.print(f"[cyan]Calling change function with:[/cyan]")
            console.print(f"  [dim]Strength:[/dim] {strength_value}")
            console.print(f"  [dim]Temperature:[/dim] {temperature_value}")
            console.print(f"  [dim]Time:[/dim] {time_value}")

            modified_prompt, cost, model_name = change(
                input_prompt=input_prompt_content,
                input_code=input_code_content,
                change_prompt=change_instructions_content,
                strength=strength_value,
                temperature=temperature_value,
                time=time_value
            )

            console.print(f"\n[green]Change function successful![/green]")
            console.print(f"  [bold]Modified Prompt:[/bold]\n{modified_prompt}")
            console.print(f"  [bold]Cost:[/bold] ${cost:.6f}")
            console.print(f"  [bold]Model Name:[/bold] {model_name}")

        except Exception as e:
            console.print(f"[bold red]Error during change function call:[/bold red] {e}")

        # To make this runnable standalone for testing, you might need a mock 'change' function
        # if the real one has complex dependencies (like LLM calls).
        # For this example, we assume 'change' is importable and works.
        </change_example>

    % Here is how to use the `get_extension` function:
        <get_extension_example>
        <include>context/get_extension_example.py</include>
        </get_extension_example>
</internal_example_modules>

% This function will do the following:
    Step 1. Read in the csv file with columns prompt_name and change_instructions.
        Note on prompt file path resolution:
        - For each prompt_name in the CSV file, attempt to locate the prompt file by trying:
            1. The exact path as specified in the CSV file
            2. The current working directory with the basename of the prompt_name
            3. The directory containing the CSV file with the basename of the prompt_name
            4. The code_directory with the basename of the prompt_name
        - If the prompt file is found in any of these locations, use it; otherwise, log an error and skip this row.
    
    Step 2. Loop through each line in the csv file:
        a. Initialize variables:
            - Initialize a list_of_jsons to store the modified prompts.
            - Read the prompt from the prompt_name column (text file).
            - Parse the prompt_name into a input_code name:
                i.  remove the path and suffix _language.prompt from the prompt_name
                ii. use the `get_extension` function to infer the extension of the input_code file, if it doesn't have a language suffix use the default input extension.
                iii. add the suffix extension to the prompt_name
                iv. change the directory to code_directory + path from prompt_name (Step i).
            - Read the input_code from the input_code_name as a string
            - Read the change_instructions from the change_instructions column
        b. Call the change function with the input_prompt, input_code, change_prompt, strength, temperature, and time.
        c. Add the returned total_cost to the total cost accumulator.
        d. If the total cost exceeds the budget, break the loop.
        e. If the change was successful, add the modified prompt to the list_of_jsons. Use the original prompt_name (full path) as the "file_name" in the output dictionary. When saving individual files to a directory, preserve the original filenames without adding any prefix.
    Step 3. Return the success status, list of modified prompts, total cost, and model name.
