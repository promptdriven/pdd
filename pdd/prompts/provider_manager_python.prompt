<pdd-reason>Manages LLM providers: search/browse registry to add models, custom providers, and model removal.</pdd-reason>

<pdd-interface>
{
  "type": "module",
  "module": {
    "functions": [
      {"name": "add_provider_from_registry", "signature": "() -> bool", "returns": "bool"},
      {"name": "add_custom_provider", "signature": "() -> bool", "returns": "bool"},
      {"name": "remove_models_by_provider", "signature": "() -> bool", "returns": "bool"},
      {"name": "remove_individual_models", "signature": "() -> bool", "returns": "bool"}
    ]
  }
}
</pdd-interface>

<pdd-dependency>litellm_registry_python.prompt</pdd-dependency>

% You are an expert Python engineer. Your goal is to write the pdd/setup/provider_manager.py module.

% Role & Scope
Handles adding and removing LLM providers and models in PDD setup. The primary flow uses litellm's bundled model registry to let users search/browse providers, pick specific models, and enter API keys. Also supports adding custom LiteLLM-compatible providers and two modes of model removal.

% Requirements

1. `add_provider_from_registry()` — interactive search/browse flow using litellm_registry:
   a. Show top ~10 providers (from `get_top_providers()`). Accept a number for direct selection, or text to search via `search_providers()`.
   b. Display selected provider's chat models in a Rich table with columns: #, Model, Input $/M, Output $/M, Max Input. Accept comma-separated numbers or "all".
   c. Look up API key env var via `get_api_key_env_var()`. If already set, offer to use existing. If not set, prompt for value. If provider not in map, ask user for env var name. Save to `~/.pdd/api-env.{shell}`.
   d. Append selected models to `~/.pdd/llm_model.csv`, skip duplicates (by provider+model pair). Map litellm data to CSV schema.
   e. Return True if any models were added.

2. `add_custom_provider()` — prompt for provider prefix, model name, API key env var, base URL (optional), costs (optional). Append row to user CSV with sensible defaults. Save API key to api-env if provided. Unchanged from previous version.

3. `remove_models_by_provider()` — group user CSV models by api_key, show numbered list with counts, remove all rows for selected provider. Comment out (never delete) the key in api-env: `# Commented out by pdd setup on YYYY-MM-DD`.

4. `remove_individual_models()` — list all models from user CSV, let user select by comma-separated numbers, remove selected rows.

5. All CSV writes must be atomic (temp file + rename).
6. Detect shell from SHELL env var for api-env file path.
7. Handle empty input as cancel/back.
8. Check if litellm is available before registry flow; suggest custom provider as fallback.

% Dependencies
<litellm_registry_example>
  <include>context/litellm_registry_example.py</include>
</litellm_registry_example>

<llm_model_csv_schema>
The master CSV at pdd/data/llm_model.csv and user CSV at ~/.pdd/llm_model.csv share columns:
provider,model,input,output,coding_arena_elo,base_url,api_key,max_reasoning_tokens,structured_output,reasoning_type,location

CSV mapping from litellm registry:
  provider      → ProviderInfo.display_name (e.g. "Anthropic")
  model         → ModelInfo.litellm_id (e.g. "claude-sonnet-4-5-20250929")
  input/output  → ModelInfo costs (per-million)
  coding_arena_elo → "1000" default
  api_key       → env var name (e.g. "ANTHROPIC_API_KEY")
  structured_output → from supports_function_calling
  Others default to empty string or "0"
</llm_model_csv_schema>

% Deliverables
- Module at `pdd/setup/provider_manager.py` exporting `add_provider_from_registry`, `add_custom_provider`, `remove_models_by_provider`, `remove_individual_models`.
