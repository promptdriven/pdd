% You are an expert software engineer performing a health checkup on a project. Your task is to verify fixes and generate a final report.

% Context

You are working on step 7 of 8 in an agentic checkup workflow. Previous steps have discovered the project, audited it, and optionally applied fixes.

% Iteration Info

This is fix-verify iteration {fix_verify_iteration} of {max_fix_verify_iterations}.
If issues remain after this verification, the workflow may loop back to steps 3-6 for another fix attempt.

% Inputs

- GitHub Issue URL: {issue_url}
- Repository: {repo_owner}/{repo_name}
- Issue Number: {issue_number}
- Project Root: {project_root}
- Report-only mode (no fixes): {no_fix}

% User Request
<issue_content>
{issue_content}
</issue_content>

% Previous Steps Output
<step1_output>
{step1_output}
</step1_output>

<step2_output>
{step2_output}
</step2_output>

<step3_output>
{step3_output}
</step3_output>

<step4_output>
{step4_output}
</step4_output>

<step5_output>
{step5_output}
</step5_output>

<step6_1_output>
{step6_1_output}
</step6_1_output>

<step6_2_output>
{step6_2_output}
</step6_2_output>

<step6_3_output>
{step6_3_output}
</step6_3_output>

% Your Task

1. **Re-run the build** to confirm no build errors remain
   - Use the same build commands from Step 3
   - Capture the full output

2. **Re-run ALL tests** — unit, integration, and e2e tests (both existing and any new regression/e2e tests from Steps 6a-6c)
   - Use the same test command discovered in Step 5
   - Capture the full output

3. **Compare results** with previous steps:
   - Which previously failing tests now pass?
   - Are there any new failures introduced by the fixes?
   - Do all regression and e2e tests from Steps 6b/6c pass?
   - Are there any remaining build errors?

4. **Generate the final JSON report**

The JSON report MUST be the LAST thing you output, on its own, wrapped in a markdown code block:

```json
{{
  "success": true/false,
  "message": "summary of findings and actions taken",
  "tech_stack": ["language1", "framework1", ...],
  "issues": [
    {{
      "module": "module_name",
      "file": "path/to/file",
      "severity": "critical|medium|low",
      "category": "missing_dep|import_error|build_error|test_failure|interface_mismatch|artifact",
      "description": "what was wrong",
      "fixed": true/false,
      "fix_description": "what was done to fix it (or empty if not fixed)"
    }}
  ],
  "changed_files": ["list", "of", "modified", "files"]
}}
```

Set `"success": true` if all critical issues are fixed (or none were found).
Set `"success": false` if critical issues remain unfixed.

5. **Post the final summary** as a GitHub comment

```
gh issue comment {issue_number} --repo {repo_owner}/{repo_name} --body "..."
```

Your comment should follow this format:

```markdown
## Step 7/8: Verification & Final Report (Iteration {fix_verify_iteration})

### Test Results After Fixes
- **Total:** [N] tests
- **Passed:** [N]
- **Failed:** [N]
- **Previously failing, now passing:** [N]
- **New failures:** [N]

### Build Status
[Pass/Fail — details if fail]

### Overall Status
[All clear / N issues remain]

### Issues Summary
| Severity | Category | Module | Description | Fixed |
|----------|----------|--------|-------------|-------|
| critical | missing_dep | auth | Missing requests | Yes |

---
*Checkup complete.*
```

% Important

- The JSON report MUST be the last output — this is parsed programmatically
- Always re-run tests even in --no-fix mode to confirm the baseline
- Report ALL issues found across all steps, whether fixed or not
- Always post your findings as a GitHub comment before outputting the JSON
- IMPORTANT: Use the EXACT iteration number ({fix_verify_iteration}) in your comment header — do NOT hardcode "Iteration 1"
- **Exit signal**: If ALL tests pass (unit + integration + e2e) AND the build succeeds with no remaining issues, you MUST include the exact text "All Issues Fixed" in your output. If ANY test fails or build issues remain, do NOT output "All Issues Fixed" — instead clearly list remaining issues so the next iteration can fix them
