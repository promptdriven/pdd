% You are an expert software engineer investigating a bug report. Your task is to create a draft pull request with the failing test and link it to the issue.

% Context

You are working on step 9 of 9 (final step) in an agentic bug investigation workflow. Previous steps have generated and verified a failing test that detects the bug.

% Inputs

- GitHub Issue URL: {issue_url}
- Repository: {repo_owner}/{repo_name}
- Issue Number: {issue_number}

% Issue Content
<issue_content>
{issue_content}
</issue_content>

% Previous Steps Output
<step1_output>
{step1_output}
</step1_output>

<step2_output>
{step2_output}
</step2_output>

<step3_output>
{step3_output}
</step3_output>

<step4_output>
{step4_output}
</step4_output>

<step5_output>
{step5_output}
</step5_output>

<step6_output>
{step6_output}
</step6_output>

<step7_output>
{step7_output}
</step7_output>

<step8_output>
{step8_output}
</step8_output>

% Your Task

1. **Prepare the branch**
   - Create a new branch named `fix/issue-{issue_number}` or similar
   - Stage the generated test file(s)
   - Commit with a descriptive message referencing the issue

2. **Create the draft PR**
   - Push the branch to origin
   - Create a draft pull request using `gh pr create --draft`
   - Link to the issue using "Fixes #{issue_number}" in the PR body

3. **Post final summary**
   - Comment on the issue with PR link and next steps for the fix

% PR Creation Command

```bash
gh pr create --draft --title "Add failing test for #{issue_number}" --body "$(cat <<'EOF'
## Summary
Adds a failing test that detects the bug reported in #{issue_number}.

## Test File
`{{test_file_path}}`

## What This PR Contains
- Failing unit test that reproduces the reported bug
- Test is verified to fail on current code and will pass once the bug is fixed

## Root Cause
{{root_cause_summary}}

## Next Steps
1. [ ] Implement the fix at the identified location
2. [ ] Verify the test passes
3. [ ] Run full test suite
4. [ ] Mark PR as ready for review

Fixes #{issue_number}

---
*Generated by PDD agentic bug workflow*
EOF
)"
```

% Output

After creating the PR, use `gh issue comment` to post your final report to issue #{issue_number}:

```
gh issue comment {issue_number} --repo {repo_owner}/{repo_name} --body "..."
```

Your comment should follow this format:

```markdown
## Step 9: Draft PR Created

### Pull Request
**PR #{{pr_number}}:** [{{pr_title}}]({{pr_url}})

### Branch
`fix/issue-{issue_number}`

### What's Included
- Failing test at `{{test_file_path}}`
- Commits: {{commit_count}}

### Next Steps for Maintainers
1. Review the failing test to understand the expected behavior
2. Implement the fix at the identified location
3. Verify the test passes with your fix
4. Run full test suite to check for regressions
5. Mark the PR as ready for review

---
*Investigation complete. A draft PR with a failing test has been created and linked to this issue.*
```

% Important

- Create a DRAFT PR (not ready for review) since it only contains the failing test
- The PR should clearly state that a fix is still needed
- Use "Fixes #{issue_number}" to auto-link the PR to the issue
- If branch creation fails (e.g., branch exists), try an alternative name
- Always post your findings as a GitHub comment before completing
